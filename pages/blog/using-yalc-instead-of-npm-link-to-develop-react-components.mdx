export const intro = `Often times as developers, we are given the task of doing some sort of component library with react. More often, we
are in organiations and placed onto teams. Sometimes, those teams own component libraries that need to be put somewhere. While things like
storybook with React are great for developing components, sometimes it makes sense to taest them in the application that they are going to
be run in. The npm link command breaks things though as it creates a symlink with two versions of React. Here's how we can fix this with yalc!
`;

export const date = "11/26/2021";
export const title =
  "Using yalc Instead Of npm link To Develop React Components";

<TitleText mt={3} title={title} date={date} />

<p>{intro}</p>

### Why?

My favorite way of building component libraries is in a monorepo using yarn
workspaces. I recently converted
[craco-babel-loader](https://github.com/rjerue/craco-babel-loader) to use such a
style here. What's nice is that since everything is using a package.json like it
would in the wild, there's little "magic" that needs to be done outside of just
using workspaces. Unfortunately, not all projects, especially enterprise ones
can fall neatly into this bucket. So, conventional wisdom says one should
probably use [npm link](https://docs.npmjs.com/cli/v8/commands/npm-link) to
develop a package seperate to where it would be used.

### npm link

Let's try it!

I've created the following repo as an example. It contains a standard CRA
application in the `cra-app` folder with `my-component` as the stand in for our
component library.

Start by cloning it down, and doing a `cd my-component` followed by a
`npm install`, `npm run build`, and finally: `npm link`. This will create a
global link for what is listed as the `name` field in the `package.json` file.
You should get a message saying that the package was added.

Now, go into the `cra-app` and do an `npm install` followed by
`npm link my-component`. This will add a symlink for `my-component` in the
node_modules folder of `cra-app`. Run `npm start` in the `cra-app` and the app
should render! There should be text that reads "Hello World" in the browser!

Mission accomplished! Time to go home right! Let's try just throwing a hook into
`MyComponent` now and doing a new build!

```jsx
import React from "react";

export const MyComponent = () => {
  React.useEffect(() => {
    console.log("npm link is my best friend!");
  }, []);
  return <div>Hello World</div>;
};
```

...and kaboom!

### npm link post mortem

You are probably here for two reasons. Either you're researching tooling for
building component libraries, or you've been burned by this guy after running
`npm link`:

```

Error: Invalid hook call. Hooks can only be called inside of the body of a
function component. This could happen for one of the following reasons:

1. You might have mismatching versions of React and the renderer (such as React
   DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app See
   https://reactjs.org/link/invalid-hook-call for tips about how to debug and
   fix this problem.

```

That's no fun! Let's take a close look at the error means!

1. My package.json in has the versions of React and React DOM being the same, so
   likely not this.
2. Pretty sure I'm not breaking the rules of hooks.
3. Is there more than one version of React?

That's our only remaining option right? There's a pretty useful command called
`npm ls` that will tell us
